<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <title>IAnimals</title>
</head>

<body>
    <header>
        <h1>IAnimals</h1>

    </header>
    <div class="container">
        <div class="left">
            <img id="uploadedImage" />
            <label for="imageInput">Seleccionar Imagen</label>
            <input type="file" id="imageInput" accept="image/*">
    
        </div>
        <div class="right">
            <select id="targetLanguage">
                <option>Selecciona un idioma...</option>
                <option value="de">Alemán(Deutsch)</option>
                <option value="ar">Árabe(عربي)</option>
                <option value="zh-Hans">Chino(中文)</option>
                <option value="cs">Checo(Česky)</option>
                <option value="da">Danés(Dansk)</option>
                <option value="es">Español(Español)</option>
                <option value="fr">Francés(Français)</option>
                <option value="el">Griego(Ελληνικά)</option>
                <option value="hi">Hindi(हिंदी)</option>
                <option value="nl">Holandés(Nederlands)</option>
                <option value="en">Inglés(English)</option>
                <option value="it">Italiano(Italiano)</option>
                <option value="ja">Japonés(日本語)</option>
                <option value="no">Noruego(Norsk)</option>
                <option value="pl">Polaco(Polski)</option>
                <option value="pt">Portugués(Português)</option>
                <option value="sv">Sueco(Svenska)</option>
                <option value="tr">Turco(Türkçe)</option>
            </select>
            <button onclick="predictAnimal()">Predecir</button>
            <h3>Resultado: </h3>
            <p><span id="predictionResult"></span></p>
    
        </div>

    </div>
    <footer>
        Juan Martin Garcia - Cristian David Trilleras - Senasoft 2023
    </footer>

    
    <script>
        const imageInput = document.getElementById('imageInput');
        const uploadedImage = document.getElementById('uploadedImage');
        const targetLanguage = document.getElementById('targetLanguage');

        imageInput.addEventListener('change', () => {
            const file = imageInput.files[0];
            if (file) {
                uploadedImage.src = URL.createObjectURL(file);
                uploadedImage.style.display = 'block'; 
            }
        });
        //funcion de prediccion
        async function predictAnimal() {
            //declaracion de variables y llamado de propiedades html
            const imageInput = document.getElementById('imageInput');
            const predictionResult = document.getElementById('predictionResult');
            const apiKey = '2f279389f85b4f8c8352bd329da4bc4c';

            const apiKeyTranslation = '9d6449b9611645fb88acfb6956198cb1';
            const translationEndpoint = 'https://api.cognitive.microsofttranslator.com/';
            
            //validacion de la insercion de la imagen
            const file = imageInput.files[0];
            if (!file) {
                alert('Por favor, selecciona una imagen.');
                return;
            }


            // Carga la imagen al servidor
            const formData = new FormData();
            formData.append('image', file);

            try {
                //consumimos nuestro servicio cognitivo con el metodo post
                const response = await fetch(`https://senasoft.cognitiveservices.azure.com/customvision/v3.0/Prediction/4d9e1c91-1f1a-42b1-8f4f-f3a7a37c7351/classify/iterations/SENASOFT-IMG/image`, {
                    method: 'POST',
                    headers: {
                        'Prediction-Key': apiKey
                    },
                    body: formData
                });
                
                //mensaje de validacion por si falla la peticion 
                if (!response.ok) {
                    throw new Error('No se pudo realizar la predicción.');
                }

                //obtenemos el tag de la imagen para asignarlo a la imagen subida
                const data = await response.json();
                const prediction = data.predictions[0];
                const predictedAnimal = prediction.tagName;

                // Traducción de la etiqueta predicha a tres idiomas diferentes, haciendo llamado a la funcion de traduccion
                

                const selectedLanguage = targetLanguage.value; // Obtener el idioma seleccionado
                // Realizar la traducción y mostrar el resultado en el idioma seleccionado
                const translation = await translateText(predictedAnimal, selectedLanguage, apiKeyTranslation, translationEndpoint);
                
                const selectedLanguageName = getLanguageName(selectedLanguage);
                const predictionResult = document.getElementById('predictionResult');
             predictionResult.textContent = `Resultado en ${selectedLanguageName}: ${translation}.`;
                
                
            } catch (error) {
                //manejo de errores por si ocurre algun fallo
                predictionResult.textContent = 'Error en la predicción. ';
                console.error(error);
            }
        }
        //funcion de traduccion con parametros
    async function translateText(text, targetLanguage, apiKey, endpoint) {
       
    const location = 'eastus';

    
        //llamamos nuestro servicio de traduccion y aplicamos metodo post
        const translationResponse = await fetch(`${endpoint}/translate?api-version=3.0&to=${targetLanguage}`, {
            method: 'POST',
            headers: {
                'Ocp-Apim-Subscription-Key': apiKey,
                'Content-Type': 'application/json',
                "Ocp-Apim-Subscription-Region": location
            },
            body: JSON.stringify([{ text }])
        });

        //validacion por si fallamos asignando los idiomas
       
            const translationData = await translationResponse.json();
            const translatedText = translationData[0].translations[0].text;
        
    

    return translatedText;
}

function getLanguageName(languageCode) {
            switch (languageCode) {
                case 'en':
                    return 'Inglés(English)';
                case 'es':
                    return 'Español(Español)';
                case 'fr':
                    return 'Francés(Français)';
                case 'it':
                    return 'Italiano(Italiano)';
                case 'de':
                    return 'Alemán(Deutsch)';
                case 'pt':
                    return 'Portugués(Português)';
                case 'ar':
                    return 'Árabe(عربي)';
                case 'hi':
                    return 'Hindi(हिंदी)';
                case 'ja':
                    return 'Japonés(日本語)';
                case 'sv':
                    return 'Sueco(Svenska)';
                case 'da':
                    return 'Danés(Dansk)';
                case 'zh-Hans':
                    return 'Chino(中文)';
                case 'nl':
                    return 'Holandés(Nederlands)';
                case 'no':
                    return 'Noruego(Norsk)';
                case 'el':
                    return 'Griego(Ελληνικά)';
                case 'tr':
                    return 'Turco(Türkçe)';
                case 'pl':
                    return 'Polaco(Polski)';
                case 'cs':
                    return 'Checo(Česky)';
                
                default:
                    return 'Desconocido(Unknown)';
            }
        }
    </script>
</body>
</html>







    </script>
</body>

</html>